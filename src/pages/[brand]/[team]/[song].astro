---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { render } from 'astro:content';

export async function getStaticPaths() {
  const allLyrics = await getCollection('lyrics');

  return allLyrics.map((entry) => {
    const segments = entry.id.split('/');
    const brandSlug = segments[0] || 'other';
    const teamSlug = segments[1] || 'other';
    const songSlug = segments[2]?.replace('.md', '') || entry.id.replace('.md', '');

    return {
      params: {
        brand: brandSlug,
        team: teamSlug,
        song: songSlug,
      },
      props: { entry },
    };
  });
}

const { entry } = Astro.props;
const { title, brand, team, themeColor, cover, audio } = entry.data;
const { Content } = await render(entry);
---

<BaseLayout title={`${title} - ${brand}`} themeColor={themeColor}>
  <main class="max-w-4xl mx-auto px-6 py-32 min-h-screen">
    <header class="mb-16 text-center">
      <img src={cover} alt={title} class="w-48 h-48 mx-auto rounded-lg shadow-2xl mb-8" transition:name={`cover-${entry.id}`} />
      <h1 class="text-5xl font-bold mb-4">{title}</h1>
      <p class="text-zinc-400 uppercase tracking-widest">{brand} {team ? `âœ¦ ${team}` : ''}</p>
    </header>

    <div class="prose prose-invert prose-pink mx-auto">
      <Content />
    </div>

    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 w-full max-w-md px-4">
      <div class="bg-zinc-900/80 backdrop-blur-md border border-white/10 p-4 rounded-2xl flex items-center gap-4">
        <audio src={audio} controls class="w-full h-8"></audio>
      </div>
    </div>
  </main>
</BaseLayout>
